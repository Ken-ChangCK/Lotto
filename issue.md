# 扭蛋機開發任務清單

## 專案概述
基於 Next.js + Three.js 打造精美的 3D 扭蛋機互動系統

參考網站：[GACHAGO! Gashapon](https://www.gachago.net/Gashapon)

---

## Phase 1: 環境搭建

### 1.1 安裝 Three.js 相關依賴
- [ ] 安裝 `@react-three/fiber`
- [ ] 安裝 `@react-three/drei`
- [ ] 安裝 `@react-three/rapier` (物理引擎)
- [ ] 安裝 `three` 核心庫
- [ ] 驗證依賴版本相容性

**預期產出：** package.json 更新完成

---

### 1.2 建立扭蛋機專案資料夾結構
```
app/gashapon/
├── page.tsx                    # 主頁面
├── components/
│   ├── GashaponMachine.tsx    # 扭蛋機組件
│   ├── GashaponBall.tsx       # 扭蛋球組件
│   ├── PrizeDisplay.tsx       # 獎項展示
│   ├── Controls.tsx           # 控制介面
│   └── ConfirmDialog.tsx      # 確認對話框
├── hooks/
│   ├── useGashapon.ts         # 扭蛋邏輯
│   └── usePrizeSystem.ts      # 獎項系統
└── store/
    └── gashaponStore.ts       # 狀態管理

public/
└── models/
    ├── gashapon-machine.glb   # 扭蛋機模型
    └── ball.glb               # 扭蛋球模型
```

**預期產出：** 資料夾結構建立完成

---

### 1.3 建立基本的 Three.js Canvas 頁面
- [ ] 創建 `/gashapon/page.tsx`
- [ ] 設置 `<Canvas>` 組件
- [ ] 配置基本 viewport 設定
- [ ] 測試頁面是否正常渲染

**預期產出：** 可以看到空白的 3D 畫布

---

## Phase 2: 基礎 3D 場景

### 2.1 設置場景光源系統
- [ ] 添加 `<ambientLight>` 環境光
- [ ] 添加 `<directionalLight>` 方向光（模擬太陽光）
- [ ] 添加 `<pointLight>` 點光源（強調重點）
- [ ] 調整光源強度和顏色
- [ ] 添加陰影效果

**預期產出：** 場景有適當的光影效果

---

### 2.2 添加測試用 3D 物體驗證場景運作
- [ ] 添加測試立方體 `<Box>`
- [ ] 添加測試球體 `<Sphere>`
- [ ] 驗證光源對物體的影響
- [ ] 測試材質渲染效果

**預期產出：** 可以看到渲染正確的 3D 物體

---

### 2.3 實現 OrbitControls 相機控制
- [ ] 從 `@react-three/drei` 導入 `OrbitControls`
- [ ] 設置相機位置和角度
- [ ] 配置滑鼠/觸控控制
- [ ] 限制相機旋轉範圍
- [ ] 設置合適的縮放限制

**預期產出：** 可以用滑鼠旋轉、縮放場景

---

## Phase 3: 扭蛋機模型

### 3.1 尋找或製作扭蛋機 3D 模型
- [ ] 選項 A: 從免費模型庫下載（Sketchfab, CGTrader）
- [ ] 選項 B: 使用 Blender 自製簡單模型
- [ ] 選項 C: 使用程式化建模
- [ ] 確保模型格式為 `.glb` 或 `.gltf`
- [ ] 優化模型檔案大小（< 5MB）

**預期產出：** 取得扭蛋機 3D 模型檔案

---

### 3.2 使用 useGLTF 載入扭蛋機模型
- [ ] 將模型放入 `public/models/`
- [ ] 創建 `GashaponMachine.tsx` 組件
- [ ] 使用 `useGLTF` hook 載入模型
- [ ] 處理載入錯誤狀態
- [ ] 添加 loading 狀態提示

**預期產出：** 扭蛋機模型顯示在場景中

---

### 3.3 調整扭蛋機材質、貼圖和位置
- [ ] 調整模型位置、旋轉、縮放
- [ ] 優化材質（metalness, roughness）
- [ ] 調整貼圖和顏色
- [ ] 確保模型與場景比例協調
- [ ] 固定扭蛋機位置

**預期產出：** 扭蛋機視覺效果精美

---

## Phase 4: 互動機制

### 4.1 建立扭蛋球 3D 組件
- [ ] 創建 `GashaponBall.tsx`
- [ ] 使用 `<Sphere>` 或載入球體模型
- [ ] 設計扭蛋球外觀（透明殼 + 內部顏色）
- [ ] 添加球體材質和反光效果
- [ ] 設置初始位置（扭蛋機出口）

**預期產出：** 扭蛋球組件可重複使用

---

### 4.2 實現 Raycaster 點擊偵測功能
- [ ] 使用 `@react-three/drei` 的 `useSelect` 或手動實現
- [ ] 監聽扭蛋球點擊事件
- [ ] 添加 hover 效果（滑鼠懸停高亮）
- [ ] 處理點擊回調函數
- [ ] 測試點擊精確度

**預期產出：** 點擊扭蛋球會觸發事件

---

### 4.3 整合物理引擎實現扭蛋掉落動畫
- [ ] 設置 `<Physics>` 物理世界
- [ ] 將扭蛋球設為 `<RigidBody>`
- [ ] 設置重力和碰撞參數
- [ ] 添加地面碰撞體
- [ ] 調整掉落速度和彈跳效果

**預期產出：** 扭蛋球自然掉落並彈跳

---

## Phase 5: 獎項系統

### 5.1 設計獎項資料結構
```typescript
interface Prize {
  id: string;
  name: string;
  image: string;
  probability: number;  // 0-100
  rarity: 'common' | 'rare' | 'epic' | 'legendary';
  description?: string;
}
```

- [ ] 定義 TypeScript 介面
- [ ] 建立範例獎項資料
- [ ] 決定儲存方式（localStorage / API）
- [ ] 驗證資料結構

**預期產出：** 獎項資料結構定義完成

---

### 5.2 實現機率抽獎演算法
- [ ] 實作加權隨機演算法
- [ ] 確保機率總和為 100%
- [ ] 處理邊界情況（空獎池）
- [ ] 添加單元測試驗證機率分布
- [ ] 實現保底機制（可選）

**預期產出：** 抽獎邏輯正確運作

---

### 5.3 建立獎項展示組件
- [ ] 創建 `PrizeDisplay.tsx`
- [ ] 設計獎項卡片 UI
- [ ] 添加稀有度顏色區分
- [ ] 實現獎項圖片展示
- [ ] 添加獎項名稱和描述

**預期產出：** 抽到獎項後美觀展示

---

## Phase 6: UI 介面

### 6.1 建立控制按鈕 UI
- [ ] 設計「抽扭蛋」主按鈕
- [ ] 設計「重來」按鈕
- [ ] 添加按鈕 hover 和 active 狀態
- [ ] 實現按鈕點擊事件
- [ ] 添加按鈕禁用狀態（抽獎中）

**預期產出：** 控制按鈕功能完整

---

### 6.2 實作獎項新增/編輯管理介面
- [ ] 創建獎項管理頁面/彈窗
- [ ] 實現新增獎項表單
- [ ] 實現編輯獎項功能
- [ ] 實現刪除獎項功能
- [ ] 添加圖片上傳功能
- [ ] 機率設定與驗證（總和 100%）

**預期產出：** 可動態管理獎項池

---

### 6.3 添加確認對話框組件
- [ ] 創建 `ConfirmDialog.tsx`
- [ ] 設計對話框 UI（標題、內容、按鈕）
- [ ] 實現「取消」和「確定」邏輯
- [ ] 添加對話框動畫效果
- [ ] 整合到重置功能

**預期產出：** 重要操作有確認提示

---

## Phase 7: 動畫美化

### 7.1 實現扭蛋球開啟動畫效果
- [ ] 設計開蛋動畫序列
- [ ] 實現球體分裂效果
- [ ] 添加獎項彈出動畫
- [ ] 添加粒子特效（可選）
- [ ] 調整動畫時間曲線

**預期產出：** 開蛋過程生動有趣

---

### 7.2 優化所有動畫過渡效果
- [ ] 使用 `react-spring` 或 `framer-motion`
- [ ] 優化按鈕過渡動畫
- [ ] 優化獎項展示動畫
- [ ] 優化頁面切換動畫
- [ ] 確保 60fps 流暢度

**預期產出：** 所有動畫流暢自然

---

### 7.3 添加音效
- [ ] 準備音效檔案（掉落、開蛋、中獎）
- [ ] 實現音效播放系統
- [ ] 添加掉落碰撞音效
- [ ] 添加開蛋音效
- [ ] 添加中獎慶祝音效
- [ ] 實現音效開關控制

**預期產出：** 互動有聲音回饋

---

## Phase 8: 優化上線

### 8.1 效能優化
- [ ] 實現模型 LOD (Level of Detail)
- [ ] 使用 `InstancedMesh` 優化多球渲染
- [ ] 實現 3D 資源懶加載
- [ ] 優化貼圖大小和格式
- [ ] 使用 `React.memo` 避免不必要渲染
- [ ] 分析 bundle size 並優化

**預期產出：** 載入速度 < 3 秒

---

### 8.2 實現響應式設計
- [ ] 測試手機版排版
- [ ] 調整平板尺寸 UI
- [ ] 測試桌面大螢幕
- [ ] 優化觸控操作體驗
- [ ] 調整 Canvas 大小自適應
- [ ] 處理橫豎屏切換

**預期產出：** 所有裝置體驗良好

---

### 8.3 部署到生產環境並測試
- [ ] 配置 Vercel/Netlify 部署
- [ ] 設置環境變數
- [ ] 測試生產環境功能
- [ ] 配置 SEO meta tags
- [ ] 添加 Google Analytics（可選）
- [ ] 進行跨瀏覽器測試

**預期產出：** 專案成功上線

---

## 開發建議

### 最快看到效果的順序
1. **Phase 1-2** → 3D 場景基礎建立
2. **Phase 3** → 扭蛋機模型載入（視覺成型）
3. **Phase 4** → 互動機制（可玩性）
4. **Phase 5** → 抽獎系統（核心邏輯）
5. **Phase 6-8** → 美化與優化

### 技術重點
- 使用 **React Three Fiber** 簡化 Three.js 開發
- 使用 **Zustand** 管理狀態（輕量級）
- 使用 **Tailwind CSS** 快速建立 UI
- 優先功能實現，再優化效能

---

## 進度追蹤

- [ ] Phase 1: 環境搭建 (0/3)
- [ ] Phase 2: 基礎 3D 場景 (0/3)
- [ ] Phase 3: 扭蛋機模型 (0/3)
- [ ] Phase 4: 互動機制 (0/3)
- [ ] Phase 5: 獎項系統 (0/3)
- [ ] Phase 6: UI 介面 (0/3)
- [ ] Phase 7: 動畫美化 (0/3)
- [ ] Phase 8: 優化上線 (0/3)

**總進度：0/24 任務完成**

---

*最後更新：2025-12-27*
